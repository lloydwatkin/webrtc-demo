!function n(t,e,r){function i(a,s){if(!e[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(o)return o(a,!0);throw new Error("Cannot find module '"+a+"'")}var u=e[a]={exports:{}};t[a][0].call(u.exports,function(n){var e=t[a][1][n];return i(e?e:n)},u,u.exports,n,t,e,r)}return e[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(n){var t=n("jingle"),e=n("attachmediastream"),r=new Primus("https://xmpp-ftw.jit.su"),i=new t,o=document.getElementById("loginInfo"),a=!1;o.onsubmit=function(n){n.preventDefault&&n.preventDefault();{var t=document.getElementById("jid").value;t.slice(0,t.indexOf("@"))}console.log("Connected"),r.send("xmpp.login",{jid:t,password:document.getElementById("password").value,host:document.getElementById("host").value,resource:document.getElementById("resource").value||null}),r.on("xmpp.connection",function(n){console.log("connected",n),r.send("xmpp.presence",{}),document.getElementById("myJID").textContent=n.jid.user+"@"+n.jid.domain+"/"+n.jid.resource}),i.on("incoming",function(n){console.log("incoming session",n),n.accept()}),i.on("peerStreamAdded",function(n){console.log("peerStreamAdded",n),e(n.stream,document.getElementById("remoteVideo"))}),i.on("localStream",function(n){!1===a&&(e(n,document.getElementById("localVideo"),{muted:!0,mirror:!0}),a=!0)}),i.on("send",function(n){n.jingle&&"session-accept"==n.jingle.action&&(console.debug("sending",n),window.jingleAccept=n),r.send("xmpp.jingle.request",n,function(t,e){return t?console.error("Failed",t):void console.log(n.jingle.action+" ack",e)})});var o=document.getElementById("callInfo");return o.onsubmit=function(n){n.preventDefault();var t=document.getElementById("peer").value;return i.startLocalMedia(null,function(){a=!0;var n=i.createMediaSession(t);n.start(),console.log("Calling "+t)}),!1},!1},r.on("xmpp.error.client",function(n){console.error(n)}),i.startLocalMedia(null,function(n,t){return n?console.error(n):(e(t,document.getElementById("localVideo"),{muted:!0,mirror:!0}),void(a=!0))}),r.on("xmpp.jingle.request",function(n){!1===a&&(i.startLocalMedia(null,function(n,t){return n?console.error(n):void e(t,document.getElementById("localVideo"),{muted:!0,mirror:!0})}),a=!0),i.process(n)})},{attachmediastream:2,jingle:6}],2:[function(n,t){t.exports=function(n,t,e){var r,i=window.URL,o={autoplay:!0,mirror:!1,muted:!1},a=t||document.createElement("video");if(e)for(r in e)o[r]=e[r];if(o.autoplay&&(a.autoplay="autoplay"),o.muted&&(a.muted=!0),o.mirror&&["","moz","webkit","o","ms"].forEach(function(n){var t=n?n+"Transform":"transform";a.style[t]="scaleX(-1)"}),i&&i.createObjectURL)a.src=i.createObjectURL(n);else if(a.srcObject)a.srcObject=n;else{if(!a.mozSrcObject)return!1;a.mozSrcObject=n}return a}},{}],3:[function(n,t,e){function r(n){return"[object Array]"===u.call(n)}function i(n,t){var e;if(null===n)e={__proto__:null};else{if("object"!=typeof n)throw new TypeError("typeof prototype["+typeof n+"] != 'object'");var r=function(){};r.prototype=n,e=new r,e.__proto__=n}return"undefined"!=typeof t&&Object.defineProperties&&Object.defineProperties(e,t),e}function o(n){return"object"!=typeof n&&"function"!=typeof n||null===n}function a(n){if(o(n))throw new TypeError("Object.keys called on a non-object");var t=[];for(var e in n)l.call(n,e)&&t.push(e);return t}function s(n){if(o(n))throw new TypeError("Object.getOwnPropertyNames called on a non-object");var t=a(n);return e.isArray(n)&&-1===e.indexOf(n,"length")&&t.push("length"),t}function c(n,t){return{value:n[t]}}var u=Object.prototype.toString,l=Object.prototype.hasOwnProperty;e.isArray="function"==typeof Array.isArray?Array.isArray:r,e.indexOf=function(n,t){if(n.indexOf)return n.indexOf(t);for(var e=0;e<n.length;e++)if(t===n[e])return e;return-1},e.filter=function(n,t){if(n.filter)return n.filter(t);for(var e=[],r=0;r<n.length;r++)t(n[r],r,n)&&e.push(n[r]);return e},e.forEach=function(n,t,e){if(n.forEach)return n.forEach(t,e);for(var r=0;r<n.length;r++)t.call(e,n[r],r,n)},e.map=function(n,t){if(n.map)return n.map(t);for(var e=new Array(n.length),r=0;r<n.length;r++)e[r]=t(n[r],r,n);return e},e.reduce=function(n,t,e){if(n.reduce)return n.reduce(t,e);var r,i=!1;2<arguments.length&&(r=e,i=!0);for(var o=0,a=n.length;a>o;++o)n.hasOwnProperty(o)&&(i?r=t(r,n[o],o,n):(r=n[o],i=!0));return r},e.substr="b"!=="ab".substr(-1)?function(n,t,e){return 0>t&&(t=n.length+t),n.substr(t,e)}:function(n,t,e){return n.substr(t,e)},e.trim=function(n){return n.trim?n.trim():n.replace(/^\s+|\s+$/g,"")},e.bind=function(){var n=Array.prototype.slice.call(arguments),t=n.shift();if(t.bind)return t.bind.apply(t,n);var e=n.shift();return function(){t.apply(e,n.concat([Array.prototype.slice.call(arguments)]))}},e.create="function"==typeof Object.create?Object.create:i;var f="function"==typeof Object.keys?Object.keys:a,p="function"==typeof Object.getOwnPropertyNames?Object.getOwnPropertyNames:s;if((new Error).hasOwnProperty("description")){var d=function(n,t){return"[object Error]"===u.call(n)&&(t=e.filter(t,function(n){return"description"!==n&&"number"!==n&&"message"!==n})),t};e.keys=function(n){return d(n,f(n))},e.getOwnPropertyNames=function(n){return d(n,p(n))}}else e.keys=f,e.getOwnPropertyNames=p;if("function"==typeof Object.getOwnPropertyDescriptor)try{Object.getOwnPropertyDescriptor({a:1},"a"),e.getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor}catch(h){e.getOwnPropertyDescriptor=function(n,t){try{return Object.getOwnPropertyDescriptor(n,t)}catch(e){return c(n,t)}}}else e.getOwnPropertyDescriptor=c},{}],4:[function(n,t,e){function r(n,t){var r={seen:[],stylize:o};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),h(t)?r.showHidden=t:t&&e._extend(r,t),b(r.showHidden)&&(r.showHidden=!1),b(r.depth)&&(r.depth=2),b(r.colors)&&(r.colors=!1),b(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=i),s(r,n,r.depth)}function i(n,t){var e=r.styles[t];return e?"["+r.colors[e][0]+"m"+n+"["+r.colors[e][1]+"m":n}function o(n){return n}function a(n){var t={};return T.forEach(n,function(n){t[n]=!0}),t}function s(n,t,r){if(n.customInspect&&t&&k(t.inspect)&&t.inspect!==e.inspect&&(!t.constructor||t.constructor.prototype!==t)){var i=t.inspect(r);return y(i)||(i=s(n,i,r)),i}var o=c(n,t);if(o)return o;var h=T.keys(t),g=a(h);if(n.showHidden&&(h=T.getOwnPropertyNames(t)),0===h.length){if(k(t)){var m=t.name?": "+t.name:"";return n.stylize("[Function"+m+"]","special")}if(S(t))return n.stylize(RegExp.prototype.toString.call(t),"regexp");if(x(t))return n.stylize(Date.prototype.toString.call(t),"date");if(O(t))return u(t)}var v="",w=!1,b=["{","}"];if(d(t)&&(w=!0,b=["[","]"]),k(t)){var j=t.name?": "+t.name:"";v=" [Function"+j+"]"}if(S(t)&&(v=" "+RegExp.prototype.toString.call(t)),x(t)&&(v=" "+Date.prototype.toUTCString.call(t)),O(t)&&(v=" "+u(t)),0===h.length&&(!w||0==t.length))return b[0]+v+b[1];if(0>r)return S(t)?n.stylize(RegExp.prototype.toString.call(t),"regexp"):n.stylize("[Object]","special");n.seen.push(t);var E;return E=w?l(n,t,r,g,h):h.map(function(e){return f(n,t,r,g,e,w)}),n.seen.pop(),p(E,v,b)}function c(n,t){if(b(t))return n.stylize("undefined","undefined");if(y(t)){var e="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return n.stylize(e,"string")}return v(t)?n.stylize(""+t,"number"):h(t)?n.stylize(""+t,"boolean"):g(t)?n.stylize("null","null"):void 0}function u(n){return"["+Error.prototype.toString.call(n)+"]"}function l(n,t,e,r,i){for(var o=[],a=0,s=t.length;s>a;++a)o.push(D(t,String(a))?f(n,t,e,r,String(a),!0):"");return T.forEach(i,function(i){i.match(/^\d+$/)||o.push(f(n,t,e,r,i,!0))}),o}function f(n,t,e,r,i,o){var a,c,u;if(u=T.getOwnPropertyDescriptor(t,i)||{value:t[i]},u.get?c=u.set?n.stylize("[Getter/Setter]","special"):n.stylize("[Getter]","special"):u.set&&(c=n.stylize("[Setter]","special")),D(r,i)||(a="["+i+"]"),c||(T.indexOf(n.seen,u.value)<0?(c=g(e)?s(n,u.value,null):s(n,u.value,e-1),c.indexOf("\n")>-1&&(c=o?c.split("\n").map(function(n){return"  "+n}).join("\n").substr(2):"\n"+c.split("\n").map(function(n){return"   "+n}).join("\n"))):c=n.stylize("[Circular]","special")),b(a)){if(o&&i.match(/^\d+$/))return c;a=JSON.stringify(""+i),a.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=n.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=n.stylize(a,"string"))}return a+": "+c}function p(n,t,e){var r=0,i=T.reduce(n,function(n,t){return r++,t.indexOf("\n")>=0&&r++,n+t.replace(/\u001b\[\d\d?m/g,"").length+1},0);return i>60?e[0]+(""===t?"":t+"\n ")+" "+n.join(",\n  ")+" "+e[1]:e[0]+t+" "+n.join(", ")+" "+e[1]}function d(n){return T.isArray(n)}function h(n){return"boolean"==typeof n}function g(n){return null===n}function m(n){return null==n}function v(n){return"number"==typeof n}function y(n){return"string"==typeof n}function w(n){return"symbol"==typeof n}function b(n){return void 0===n}function S(n){return j(n)&&"[object RegExp]"===C(n)}function j(n){return"object"==typeof n&&n}function x(n){return j(n)&&"[object Date]"===C(n)}function O(n){return j(n)&&"[object Error]"===C(n)}function k(n){return"function"==typeof n}function E(n){return null===n||"boolean"==typeof n||"number"==typeof n||"string"==typeof n||"symbol"==typeof n||"undefined"==typeof n}function A(n){return n&&"object"==typeof n&&"function"==typeof n.copy&&"function"==typeof n.fill&&"function"==typeof n.binarySlice}function C(n){return Object.prototype.toString.call(n)}function _(n){return 10>n?"0"+n.toString(10):n.toString(10)}function I(){var n=new Date,t=[_(n.getHours()),_(n.getMinutes()),_(n.getSeconds())].join(":");return[n.getDate(),P[n.getMonth()],t].join(" ")}function D(n,t){return Object.prototype.hasOwnProperty.call(n,t)}var T=n("_shims"),M=/%[sdj%]/g;e.format=function(n){if(!y(n)){for(var t=[],e=0;e<arguments.length;e++)t.push(r(arguments[e]));return t.join(" ")}for(var e=1,i=arguments,o=i.length,a=String(n).replace(M,function(n){if("%%"===n)return"%";if(e>=o)return n;switch(n){case"%s":return String(i[e++]);case"%d":return Number(i[e++]);case"%j":try{return JSON.stringify(i[e++])}catch(t){return"[Circular]"}default:return n}}),s=i[e];o>e;s=i[++e])a+=g(s)||!j(s)?" "+s:" "+r(s);return a},e.inspect=r,r.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},r.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=d,e.isBoolean=h,e.isNull=g,e.isNullOrUndefined=m,e.isNumber=v,e.isString=y,e.isSymbol=w,e.isUndefined=b,e.isRegExp=S,e.isObject=j,e.isDate=x,e.isError=O,e.isFunction=k,e.isPrimitive=E,e.isBuffer=A;var P=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];e.log=function(){console.log("%s - %s",I(),e.format.apply(e,arguments))},e.inherits=function(n,t){n.super_=t,n.prototype=T.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}})},e._extend=function(n,t){if(!t||!j(t))return n;for(var e=T.keys(t),r=e.length;r--;)n[e[r]]=t[e[r]];return n}},{_shims:3}],5:[function(n,t){var e=t.exports={};e.nextTick=function(){var n="undefined"!=typeof window&&window.setImmediate,t="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(n)return function(n){return window.setImmediate(n)};if(t){var e=[];return window.addEventListener("message",function(n){var t=n.source;if((t===window||null===t)&&"process-tick"===n.data&&(n.stopPropagation(),e.length>0)){var r=e.shift();r()}},!0),function(n){e.push(n),window.postMessage("process-tick","*")}}return function(n){setTimeout(n,0)}}(),e.title="browser",e.browser=!0,e.env={},e.argv=[],e.binding=function(){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(){throw new Error("process.chdir is not supported")}},{}],6:[function(n,t){t.exports=n("./lib/sessionManager")},{"./lib/sessionManager":9}],7:[function(n,t){function e(n){var t=n.split("-");return"on"+t[0][0].toUpperCase()+t[0].substr(1)+t[1][0].toUpperCase()+t[1].substr(1)}function r(n){var t=this;this.sid=n.sid||Date.now().toString(),this.peer=n.peer,this.isInitiator=n.initiator||!1,this.state="starting",this.parent=n.parent,this.processingQueue=o.queue(function(n,e){var r=n.action,i=n.changes,o=n.cb;s(t.sid+": "+r),t[r](i,function(n){o(n),e()})})}var i=n("bows"),o=n("async"),a=n("wildemitter"),s=i("JingleSession");r.prototype=Object.create(a.prototype,{constructor:{value:r}}),r.prototype.process=function(n,t,r){var i=e(n);this.processingQueue.push({action:i,changes:t,cb:r})},r.prototype.send=function(n,t){t=t||{},t.sid=this.sid,t.action=n,this.parent.emit("send",{to:this.peer,type:"set",jingle:t})},Object.defineProperty(r.prototype,"state",{get:function(){return this._state},set:function(n){var t={starting:!0,pending:!0,active:!0,ended:!0};if(!t[n])throw new Error("Invalid Jingle Session State: "+n);this._state!==n&&(this._state=n,s(this.sid+": State changed to "+n))}}),Object.defineProperty(r.prototype,"starting",{get:function(){return"starting"==this._state}}),Object.defineProperty(r.prototype,"pending",{get:function(){return"pending"==this._state}}),Object.defineProperty(r.prototype,"active",{get:function(){return"active"==this._state}}),Object.defineProperty(r.prototype,"ended",{get:function(){return"ended"==this._state}}),r.prototype.start=function(){this.state="pending",s(this.sid+": Can not start generic session")},r.prototype.end=function(n,t){this.parent.peers[this.peer].splice(this.parent.peers[this.peer].indexOf(this),1),delete this.parent.sessions[this.sid],this.state="ended",n=n||{},t||this.send("session-terminate",{reason:n}),this.parent.emit("terminated",this,n)};var c=["content-accept","content-add","content-modify","content-reject","content-remove","description-info","session-accept","session-info","session-initiate","session-terminate","transport-accept","transport-info","transport-reject","transport-replace"];c.forEach(function(n){var t=e(n);r.prototype[t]=function(t,e){s(this.sid+": Unsupported action "+n),e()}}),t.exports=r},{async:10,bows:11,wildemitter:26}],8:[function(n,t){function e(n){a.call(this,n);var t=this,e=this.parent.config.peerConnectionConfig,r=this.parent.config.peerConnectionConstraints;e.useJingle=!0,this.pc=new s(e,r),this.pc.on("ice",this.onIceCandidate.bind(this)),this.pc.on("addStream",this.onStreamAdded.bind(this)),this.pc.on("removeStream",this.onStreamRemoved.bind(this)),this.parent.localStream?(this.pc.addStream(this.parent.localStream),this.localStream=this.parent.localStream):this.parent.once("localStream",function(n){t.pc.addStream(n),this.localStream=n})}var r=n("underscore"),i=n("util"),o=n("bows"),a=n("./genericSession"),s=n("rtcpeerconnection"),c=o("JingleMedia");i.inherits(e,a),Object.defineProperty(e.prototype,"streams",{get:function(){return this.pc.remoteStreams}}),e.prototype=r.extend(e.prototype,{start:function(){var n=this;this.state="pending",this.pc.isInitiator=!0,this.pc.offer(function(t,e){n.send("session-initiate",e.jingle)})},end:function(n){var t=this;this.pc.close(),r.each(this.streams,function(n){t.onStreamRemoved({stream:n})}),a.prototype.end.call(this,n)},accept:function(){var n=this;c(this.sid+": Accepted incoming session"),this.state="active",this.pc.answer(function(t,e){return t?c(n.sid+": Could not create WebRTC answer",t):void n.send("session-accept",e.jingle)})},ring:function(){c(this.sid+": Ringing on incoming session"),this.send("session-info",{ringing:!0})},mute:function(n,t){c(this.sid+": Muting"),this.send("session-info",{mute:{creator:n,name:t}})},unmute:function(n,t){c(this.sid+": Unmuting"),this.send("session-info",{unmute:{creator:n,name:t}})},hold:function(){c(this.sid+": Placing on hold"),this.send("session-info",{hold:!0})},resume:function(){c(this.sid+": Resuing from hold"),this.send("session-info",{active:!0})},onSessionInitiate:function(n,t){var e=this;c(e.sid+": Initiating incoming session"),this.state="pending",this.pc.isInitiator=!1,this.pc.handleOffer({type:"offer",jingle:n},function(n){return n?(c(e.sid+": Could not create WebRTC answer",n),t({condition:"general-error"})):void t()})},onSessionAccept:function(n,t){var e=this;c(this.sid+": Activating accepted outbound session"),this.state="active",this.pc.handleAnswer({type:"answer",jingle:n},function(n){return n?(c(e.sid+": Could not process WebRTC answer",n),t({condition:"general-error"})):(e.parent.emit("accepted",e),void t())})},onSessionTerminate:function(n,t){var e=this;c(this.sid+": Terminating session"),this.pc.close(),r.each(this.streams,function(n){e.onStreamRemoved({stream:n})}),a.prototype.end.call(this,n.reason,!0),t()},onTransportInfo:function(n,t){var e=this;c(this.sid+": Adding ICE candidate"),this.pc.processIce(n,function(n){n&&c(e.sid+": Could not process ICE candidate",n),t()})},onSessionInfo:function(n,t){c(n),n.ringing&&(c(this.sid+": Ringing on remote stream"),this.parent.emit("ringing",this)),n.hold&&(c(this.sid+": On hold"),this.parent.emit("hold",this)),n.active&&(c(this.sid+": Resumed from hold"),this.parent.emit("resumed",this)),n.mute&&(c(this.sid+": Muted",n.mute),this.parent.emit("mute",this,n.mute)),n.unmute&&(c(this.sid+": Unmuted",n.unmute),this.parent.emit("unmute",this,n.unmute)),t()},onIceCandidate:function(n){c(this.sid+": Discovered new ICE candidate",n.jingle),this.send("transport-info",n.jingle)},onStreamAdded:function(n){var t=this;c(this.sid+": Remote media stream added"),n.stream.onended=function(){t.onStreamRemoved({stream:n.stream})},this.parent.emit("peerStreamAdded",this,n.stream)},onStreamRemoved:function(n){c(this.sid+": Remote media stream removed"),this.parent.emit("peerStreamRemoved",this,n.stream)}}),t.exports=e},{"./genericSession":7,bows:11,rtcpeerconnection:19,underscore:24,util:4}],9:[function(n,t){function e(n){n=n||{};var t=this.config={debug:!1,peerConnectionConfig:{iceServers:[{url:"stun:stun.l.google.com:19302"}]},peerConnectionConstraints:{optional:[{DtlsSrtpKeyAgreement:!0},{RtpDataChannels:!1}]},autoAdjustMic:!1,media:{audio:!0,video:!0}};this.MediaSession=f,this.jid=n.jid,this.sessions={},this.peers={},this.screenSharingSupport=a.screenSharing;for(var e in n)t[e]=n[e];this.capabilities=["urn:xmpp:jingle:1"],a.support?this.capabilities=["urn:xmpp:jingle:1","urn:xmpp:jingle:apps:rtp:1","urn:xmpp:jingle:apps:rtp:audio","urn:xmpp:jingle:apps:rtp:video","urn:xmpp:jingle:apps:rtp:rtcb-fb:0","urn:xmpp:jingle:apps:rtp:rtp-hdrext:0","urn:xmpp:jingle:apps:rtp:ssma:0","urn:xmpp:jingle:apps:dtls:0","urn:xmpp:jingle:apps:grouping:0","urn:xmpp:jingle:transports:ice-udp:1","urn:ietf:rfc:3264","urn:ietf:rfc:5576","urn:ietf:rfc:5888"]:p("WebRTC not supported"),c.call(this),this.config.debug&&this.on("*",function(n,t,e){p(n,t,e)})}var r=n("underscore"),i=n("bows"),o=n("hark"),a=n("webrtcsupport"),s=(n("mockconsole"),n("getusermedia")),c=n("wildemitter"),u=n("mediastream-gain"),l=n("./genericSession"),f=n("./mediaSession"),p=i("Jingle");e.prototype=Object.create(c.prototype,{constructor:{value:e}}),e.prototype.addICEServer=function(n){this.config.peerConnectionConfig.iceServers.push(n)},e.prototype.startLocalMedia=function(n,t){var e=this,r=n||{video:!0,audio:!0};s(r,function(n,i){n?p("Could not start local media"):(r.audio&&e.config.detectSpeakingEvents&&e.setupAudioMonitor(i),e.localStream=i,e.config.autoAdjustMic&&(e.gainController=new u(i),e.setMicIfEnabled(.5)),p("Local media stream started"),e.emit("localStream",i)),t&&t(n,i)})},e.prototype.stopLocalMedia=function(){this.localStream&&(this.localStream.stop(),this.emit("localStreamStopped"))},e.prototype.setupAudioMonitor=function(n){p("Setup audio");var t,e=o(n),r=this;e.on("speaking",function(){r.hardMuted||(r.setMicIfEnabled(1),r.emit("speaking"))}),e.on("stopped_speaking",function(){r.hardMuted||(t&&clearTimeout(t),t=setTimeout(function(){r.setMicIfEnabled(.5),r.emit("stoppedSpeaking")},1e3))})},e.prototype.setMicIfEnabled=function(n){this.config.autoAdjustMic&&this.gainController.setGain(n)},e.prototype.sendError=function(n,t,e){e.type="cancel",this.emit("send",{to:n,id:t,type:"error",error:e})},e.prototype.process=function(n){var t=this;if("error"===n.type)return this.emit("error",n);if("result"!==n.type){var e,i,o,a=n.jingle.sid,s=n.jingle.action,c=n.jingle.contents||[],u=r.map(c,function(n){return(n.description||{}).descType}),d=this.sessions[a]||null,h=n.from.full||n.from,g=n.id;if("session-initiate"!==s){if(!d)return p("Unknown session",a),this.sendError(h,g,{condition:"item-not-found",jingleCondition:"unknown-session"});if(d.peer!==h||d.ended)return p("Session has ended, or action has wrong sender"),this.sendError(h,g,{condition:"item-not-found",jingleCondition:"unknown-session"});if("session-accept"===s&&!d.pending)return p("Tried to accept session twice",a),this.sendError(h,g,{condition:"unexpected-request",jingleCondition:"out-of-order"});if("session-terminate"!==s&&d.pendingAction&&(p("Tie break during pending request"),d.isInitiator))return this.sendError(h,g,{condition:"conflict",jingleCondition:"tie-break"})}else{if(d)return d.peer!==h?(p("Duplicate sid from new sender"),this.sendError(h,g,{condition:"service-unavailable"})):d.pending&&this.jid>d.peer?(p("Tie break new session because of duplicate sids"),this.sendError(h,g,{condition:"conflict",jingleCondition:"tie-break"})):(p("Someone is doing this wrong"),this.sendError(h,g,{condition:"unexpected-request",jingleCondition:"out-of-order"}));if(Object.keys(this.peers[h]||{}).length){e=Object.keys(this.peers[h]);for(var m=0;m<e.length;m++)if(i=e[m],o=this.sessions[i],o&&o.pending&&r.intersection(u,o.contentTypes).length&&i>a)return p("Tie break"),this.sendError(h,g,{condition:"conflict",jingleCondition:"tie-break"})}}if("session-initiate"===s){var v={sid:a,peer:h,initiator:!1,parent:this};d=u.indexOf("rtp")>=0?new f(v):new l(v),this.sessions[a]=d,this.peers[h]||(this.peers[h]=[]),this.peers[h].push(d)}d.process(s,n.jingle,function(e){e?(p("Could not process request",n,e),t.sendError(h,g,e)):(t.emit("send",{to:h,id:g,type:"result",action:s}),"session-initiate"===s&&(p("Incoming session request from ",h,d),t.emit("incoming",d)))})}},e.prototype.createMediaSession=function(n,t){var e=new f({sid:t,peer:n,initiator:!0,parent:this});return t=e.sid,this.sessions[t]=e,this.peers[n]||(this.peers[n]=[]),this.peers[n].push(e),p("Outgoing session",e.sid,e),this.emit("outgoing",e),e},e.prototype.endPeerSessions=function(n){p("Ending all sessions with",n);var t=this.peers[n]||[];t.forEach(function(n){n.end()})},t.exports=e},{"./genericSession":7,"./mediaSession":8,bows:11,getusermedia:13,hark:14,"mediastream-gain":16,mockconsole:17,underscore:24,webrtcsupport:25,wildemitter:26}],10:[function(n,t){var e=n("__browserify_process");!function(){function n(n){var t=!1;return function(){if(t)throw new Error("Callback was already called.");t=!0,n.apply(r,arguments)}}var r,i,o={};r=this,null!=r&&(i=r.async),o.noConflict=function(){return r.async=i,o};var a=function(n,t){if(n.forEach)return n.forEach(t);for(var e=0;e<n.length;e+=1)t(n[e],e,n)},s=function(n,t){if(n.map)return n.map(t);var e=[];return a(n,function(n,r,i){e.push(t(n,r,i))}),e},c=function(n,t,e){return n.reduce?n.reduce(t,e):(a(n,function(n,r,i){e=t(e,n,r,i)}),e)},u=function(n){if(Object.keys)return Object.keys(n);var t=[];for(var e in n)n.hasOwnProperty(e)&&t.push(e);return t};"undefined"!=typeof e&&e.nextTick?(o.nextTick=e.nextTick,o.setImmediate="undefined"!=typeof setImmediate?function(n){setImmediate(n)}:o.nextTick):"function"==typeof setImmediate?(o.nextTick=function(n){setImmediate(n)},o.setImmediate=o.nextTick):(o.nextTick=function(n){setTimeout(n,0)},o.setImmediate=o.nextTick),o.each=function(t,e,r){if(r=r||function(){},!t.length)return r();var i=0;a(t,function(o){e(o,n(function(n){n?(r(n),r=function(){}):(i+=1,i>=t.length&&r(null))}))})},o.forEach=o.each,o.eachSeries=function(n,t,e){if(e=e||function(){},!n.length)return e();var r=0,i=function(){t(n[r],function(t){t?(e(t),e=function(){}):(r+=1,r>=n.length?e(null):i())})};i()},o.forEachSeries=o.eachSeries,o.eachLimit=function(n,t,e,r){var i=l(t);i.apply(null,[n,e,r])},o.forEachLimit=o.eachLimit;var l=function(n){return function(t,e,r){if(r=r||function(){},!t.length||0>=n)return r();var i=0,o=0,a=0;!function s(){if(i>=t.length)return r();for(;n>a&&o<t.length;)o+=1,a+=1,e(t[o-1],function(n){n?(r(n),r=function(){}):(i+=1,a-=1,i>=t.length?r():s())})}()}},f=function(n){return function(){var t=Array.prototype.slice.call(arguments);return n.apply(null,[o.each].concat(t))}},p=function(n,t){return function(){var e=Array.prototype.slice.call(arguments);return t.apply(null,[l(n)].concat(e))}},d=function(n){return function(){var t=Array.prototype.slice.call(arguments);return n.apply(null,[o.eachSeries].concat(t))}},h=function(n,t,e,r){var i=[];t=s(t,function(n,t){return{index:t,value:n}}),n(t,function(n,t){e(n.value,function(e,r){i[n.index]=r,t(e)})},function(n){r(n,i)})};o.map=f(h),o.mapSeries=d(h),o.mapLimit=function(n,t,e,r){return g(t)(n,e,r)};var g=function(n){return p(n,h)};o.reduce=function(n,t,e,r){o.eachSeries(n,function(n,r){e(t,n,function(n,e){t=e,r(n)})},function(n){r(n,t)})},o.inject=o.reduce,o.foldl=o.reduce,o.reduceRight=function(n,t,e,r){var i=s(n,function(n){return n}).reverse();o.reduce(i,t,e,r)},o.foldr=o.reduceRight;var m=function(n,t,e,r){var i=[];t=s(t,function(n,t){return{index:t,value:n}}),n(t,function(n,t){e(n.value,function(e){e&&i.push(n),t()})},function(){r(s(i.sort(function(n,t){return n.index-t.index}),function(n){return n.value}))})};o.filter=f(m),o.filterSeries=d(m),o.select=o.filter,o.selectSeries=o.filterSeries;var v=function(n,t,e,r){var i=[];t=s(t,function(n,t){return{index:t,value:n}}),n(t,function(n,t){e(n.value,function(e){e||i.push(n),t()})},function(){r(s(i.sort(function(n,t){return n.index-t.index}),function(n){return n.value}))})};o.reject=f(v),o.rejectSeries=d(v);var y=function(n,t,e,r){n(t,function(n,t){e(n,function(e){e?(r(n),r=function(){}):t()})},function(){r()})};o.detect=f(y),o.detectSeries=d(y),o.some=function(n,t,e){o.each(n,function(n,r){t(n,function(n){n&&(e(!0),e=function(){}),r()})},function(){e(!1)})},o.any=o.some,o.every=function(n,t,e){o.each(n,function(n,r){t(n,function(n){n||(e(!1),e=function(){}),r()})},function(){e(!0)})},o.all=o.every,o.sortBy=function(n,t,e){o.map(n,function(n,e){t(n,function(t,r){t?e(t):e(null,{value:n,criteria:r})})},function(n,t){if(n)return e(n);var r=function(n,t){var e=n.criteria,r=t.criteria;return r>e?-1:e>r?1:0};e(null,s(t.sort(r),function(n){return n.value}))})},o.auto=function(n,t){t=t||function(){};var e=u(n);if(!e.length)return t(null);var r={},i=[],s=function(n){i.unshift(n)},l=function(n){for(var t=0;t<i.length;t+=1)if(i[t]===n)return void i.splice(t,1)},f=function(){a(i.slice(0),function(n){n()})};s(function(){u(r).length===e.length&&(t(null,r),t=function(){})}),a(e,function(e){var i=n[e]instanceof Function?[n[e]]:n[e],p=function(n){var i=Array.prototype.slice.call(arguments,1);if(i.length<=1&&(i=i[0]),n){var s={};a(u(r),function(n){s[n]=r[n]}),s[e]=i,t(n,s),t=function(){}}else r[e]=i,o.setImmediate(f)},d=i.slice(0,Math.abs(i.length-1))||[],h=function(){return c(d,function(n,t){return n&&r.hasOwnProperty(t)},!0)&&!r.hasOwnProperty(e)};if(h())i[i.length-1](p,r);else{var g=function(){h()&&(l(g),i[i.length-1](p,r))};s(g)}})},o.waterfall=function(n,t){if(t=t||function(){},n.constructor!==Array){var e=new Error("First argument to waterfall must be an array of functions");return t(e)}if(!n.length)return t();var r=function(n){return function(e){if(e)t.apply(null,arguments),t=function(){};else{var i=Array.prototype.slice.call(arguments,1),a=n.next();i.push(a?r(a):t),o.setImmediate(function(){n.apply(null,i)})}}};r(o.iterator(n))()};var w=function(n,t,e){if(e=e||function(){},t.constructor===Array)n.map(t,function(n,t){n&&n(function(n){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),t.call(null,n,e)})},e);else{var r={};n.each(u(t),function(n,e){t[n](function(t){var i=Array.prototype.slice.call(arguments,1);i.length<=1&&(i=i[0]),r[n]=i,e(t)})},function(n){e(n,r)})}};o.parallel=function(n,t){w({map:o.map,each:o.each},n,t)},o.parallelLimit=function(n,t,e){w({map:g(t),each:l(t)},n,e)},o.series=function(n,t){if(t=t||function(){},n.constructor===Array)o.mapSeries(n,function(n,t){n&&n(function(n){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),t.call(null,n,e)})},t);else{var e={};o.eachSeries(u(n),function(t,r){n[t](function(n){var i=Array.prototype.slice.call(arguments,1);i.length<=1&&(i=i[0]),e[t]=i,r(n)})},function(n){t(n,e)})}},o.iterator=function(n){var t=function(e){var r=function(){return n.length&&n[e].apply(null,arguments),r.next()};return r.next=function(){return e<n.length-1?t(e+1):null},r};return t(0)},o.apply=function(n){var t=Array.prototype.slice.call(arguments,1);return function(){return n.apply(null,t.concat(Array.prototype.slice.call(arguments)))}};var b=function(n,t,e,r){var i=[];n(t,function(n,t){e(n,function(n,e){i=i.concat(e||[]),t(n)})},function(n){r(n,i)})};o.concat=f(b),o.concatSeries=d(b),o.whilst=function(n,t,e){n()?t(function(r){return r?e(r):void o.whilst(n,t,e)}):e()},o.doWhilst=function(n,t,e){n(function(r){return r?e(r):void(t()?o.doWhilst(n,t,e):e())})},o.until=function(n,t,e){n()?e():t(function(r){return r?e(r):void o.until(n,t,e)})},o.doUntil=function(n,t,e){n(function(r){return r?e(r):void(t()?e():o.doUntil(n,t,e))})},o.queue=function(t,e){function r(n,t,r,i){t.constructor!==Array&&(t=[t]),a(t,function(t){var a={data:t,callback:"function"==typeof i?i:null};r?n.tasks.unshift(a):n.tasks.push(a),n.saturated&&n.tasks.length===e&&n.saturated(),o.setImmediate(n.process)})}void 0===e&&(e=1);var i=0,s={tasks:[],concurrency:e,saturated:null,empty:null,drain:null,push:function(n,t){r(s,n,!1,t)},unshift:function(n,t){r(s,n,!0,t)},process:function(){if(i<s.concurrency&&s.tasks.length){var e=s.tasks.shift();s.empty&&0===s.tasks.length&&s.empty(),i+=1;var r=function(){i-=1,e.callback&&e.callback.apply(e,arguments),s.drain&&s.tasks.length+i===0&&s.drain(),s.process()},o=n(r);t(e.data,o)}},length:function(){return s.tasks.length},running:function(){return i}};return s},o.cargo=function(n,t){var e=!1,r=[],i={tasks:r,payload:t,saturated:null,empty:null,drain:null,push:function(n,e){n.constructor!==Array&&(n=[n]),a(n,function(n){r.push({data:n,callback:"function"==typeof e?e:null}),i.saturated&&r.length===t&&i.saturated()}),o.setImmediate(i.process)},process:function c(){if(!e){if(0===r.length)return void(i.drain&&i.drain());var o="number"==typeof t?r.splice(0,t):r.splice(0),u=s(o,function(n){return n.data});i.empty&&i.empty(),e=!0,n(u,function(){e=!1;var n=arguments;a(o,function(t){t.callback&&t.callback.apply(null,n)}),c()})}},length:function(){return r.length},running:function(){return e}};return i};var S=function(n){return function(t){var e=Array.prototype.slice.call(arguments,1);t.apply(null,e.concat([function(t){var e=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(t?console.error&&console.error(t):console[n]&&a(e,function(t){console[n](t)}))}]))}};o.log=S("log"),o.dir=S("dir"),o.memoize=function(n,t){var e={},r={};t=t||function(n){return n};var i=function(){var i=Array.prototype.slice.call(arguments),o=i.pop(),a=t.apply(null,i);a in e?o.apply(null,e[a]):a in r?r[a].push(o):(r[a]=[o],n.apply(null,i.concat([function(){e[a]=arguments;var n=r[a];delete r[a];for(var t=0,i=n.length;i>t;t++)n[t].apply(null,arguments)}])))};return i.memo=e,i.unmemoized=n,i},o.unmemoize=function(n){return function(){return(n.unmemoized||n).apply(null,arguments)}},o.times=function(n,t,e){for(var r=[],i=0;n>i;i++)r.push(i);return o.map(r,t,e)},o.timesSeries=function(n,t,e){for(var r=[],i=0;n>i;i++)r.push(i);return o.mapSeries(r,t,e)},o.compose=function(){var n=Array.prototype.reverse.call(arguments);return function(){var t=this,e=Array.prototype.slice.call(arguments),r=e.pop();
o.reduce(n,e,function(n,e,r){e.apply(t,n.concat([function(){var n=arguments[0],t=Array.prototype.slice.call(arguments,1);r(n,t)}]))},function(n,e){r.apply(t,[n].concat(e))})}};var j=function(n,t){var e=function(){var e=this,r=Array.prototype.slice.call(arguments),i=r.pop();return n(t,function(n,t){n.apply(e,r.concat([t]))},i)};if(arguments.length>2){var r=Array.prototype.slice.call(arguments,2);return e.apply(this,r)}return e};o.applyEach=f(j),o.applyEachSeries=d(j),o.forever=function(n,t){function e(r){if(r){if(t)return t(r);throw r}n(e)}e()},"undefined"!=typeof define&&define.amd?define([],function(){return o}):"undefined"!=typeof t&&t.exports?t.exports=o:r.async=o}()},{__browserify_process:5}],11:[function(n,t){(function(){function e(){var n=!!window.chrome,t=/firefox/i.test(navigator.userAgent),e=t&&!!window.console.exception;return n||e}var r,i,o,a="undefined"==typeof window,s=!a&&window.localStorage,c=s.debug,u=n("andlog"),l=0,f=15,p=function(){},d=s.debugColors||e();r=function(){var n=.618033988749895;return l+=n,l%=1,360*l},o=c&&"/"===c[0]&&new RegExp(c.substring(1,c.length-1)),i=function(n){var t,e,i;if(t=n.slice(0,f),t+=Array(f+3-t.length).join(" ")+"|",o&&!n.match(o))return p;if(d){var a=r();t="%c"+t,e="color: hsl("+a+",99%,40%); font-weight: bold",i=u.log.bind(u,t,e),["log","debug","warn","error","info"].forEach(function(n){i[n]=u[n].bind(u,t,e)})}else i=u.log.bind(u,t),["log","debug","warn","error","info"].forEach(function(n){i[n]=u[n].bind(u,t)});return i},i.config=function(n){n.padLength&&(this.padLength=n.padLength)},"undefined"!=typeof t?t.exports=i:window.bows=i}).call()},{andlog:12}],12:[function(n,t,e){!function(){var n="undefined"==typeof window,r=!n&&window.localStorage,i={};if(n)return void(t.exports=console);if(r&&r.debug&&window.console)i=window.console;else for(var o="assert,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profileEnd,time,timeEnd,trace,warn".split(","),a=o.length,s=function(){};a--;)i[o[a]]=s;"undefined"!=typeof e?t.exports=i:window.console=i}()},{}],13:[function(n,t){var e=window.navigator.getUserMedia||window.navigator.webkitGetUserMedia||window.navigator.mozGetUserMedia||window.navigator.msGetUserMedia;t.exports=function(n,t){var r,i=2===arguments.length,o={video:!0,audio:!0},a="PERMISSION_DENIED",s="CONSTRAINT_NOT_SATISFIED";return i||(t=n,n=o),e?void e.call(window.navigator,n,function(n){t(null,n)},function(n){var e;"string"==typeof n?(e=new Error("NavigatorUserMediaError"),e.name=n===a?a:s):(e=n,e.name||(n.name=e[a]?a:s)),t(e)}):(r=new Error("NavigatorUserMediaError"),r.name="NOT_SUPPORTED_ERROR",t(r))}},{}],14:[function(n,t){function e(n,t){var e=-1/0;n.getFloatFrequencyData(t);for(var r=0,i=t.length;i>r;r++)t[r]>e&&t[r]<0&&(e=t[r]);return e}var r=n("wildemitter"),i=window.webkitAudioContext||window.AudioContext,o=null;t.exports=function(n,t){var a=new r;if(!i)return a;var t=t||{},s=t.smoothing||.5,c=t.interval||100,u=t.threshold,l=t.play;o||(o=new i);var f,p,d;d=o.createAnalyser(),d.fftSize=512,d.smoothingTimeConstant=s,p=new Float32Array(d.fftSize),n.jquery&&(n=n[0]),n instanceof HTMLAudioElement?(f=o.createMediaElementSource(n),"undefined"==typeof l&&(l=!0),u=u||-65):(f=o.createMediaStreamSource(n),u=u||-45),f.connect(d),l&&d.connect(o.destination),a.speaking=!1,a.setThreshold=function(n){u=n},a.setInterval=function(n){c=n};var h=function(){setTimeout(function(){var n=e(d,p);a.emit("volume_change",n,u),n>u?a.speaking||(a.speaking=!0,a.emit("speaking")):a.speaking&&(a.speaking=!1,a.emit("stopped_speaking")),h()},c)};return h(),a}},{wildemitter:15}],15:[function(n,t){function e(){this.callbacks={}}t.exports=e,e.prototype.on=function(n){var t=3===arguments.length,e=t?arguments[1]:void 0,r=t?arguments[2]:arguments[1];return r._groupName=e,(this.callbacks[n]=this.callbacks[n]||[]).push(r),this},e.prototype.once=function(n){function t(){e.off(n,t),o.apply(this,arguments)}var e=this,r=3===arguments.length,i=r?arguments[1]:void 0,o=r?arguments[2]:arguments[1];return this.on(n,i,t),this},e.prototype.releaseGroup=function(n){var t,e,r,i;for(t in this.callbacks)for(i=this.callbacks[t],e=0,r=i.length;r>e;e++)i[e]._groupName===n&&(i.splice(e,1),e--,r--);return this},e.prototype.off=function(n,t){var e,r=this.callbacks[n];return r?1===arguments.length?(delete this.callbacks[n],this):(e=r.indexOf(t),r.splice(e,1),this):this},e.prototype.emit=function(n){var t,e,r=[].slice.call(arguments,1),i=this.callbacks[n],o=this.getWildcardCallbacks(n);if(i)for(t=0,e=i.length;e>t&&i[t];++t)i[t].apply(this,r);if(o)for(t=0,e=o.length;e>t&&o[t];++t)o[t].apply(this,[n].concat(r));return this},e.prototype.getWildcardCallbacks=function(n){var t,e,r=[];for(t in this.callbacks)e=t.split("*"),("*"===t||2===e.length&&n.slice(0,e[1].length)===e[1])&&(r=r.concat(this.callbacks[t]));return r}},{}],16:[function(n,t){function e(n){if(this.support=r.webAudio&&r.mediaStream,this.gain=1,this.support){var t=this.context=new r.AudioContext;this.microphone=t.createMediaStreamSource(n),this.gainFilter=t.createGain(),this.destination=t.createMediaStreamDestination(),this.outputStream=this.destination.stream,this.microphone.connect(this.gainFilter),this.gainFilter.connect(this.destination),n.removeTrack(n.getAudioTracks()[0]),n.addTrack(this.outputStream.getAudioTracks()[0])}this.stream=n}var r=n("webrtcsupport");e.prototype.setGain=function(n){this.support&&(this.gainFilter.gain.value=n,this.gain=n)},e.prototype.getGain=function(){return this.gain},e.prototype.off=function(){return this.setGain(0)},e.prototype.on=function(){this.setGain(1)},t.exports=e},{webrtcsupport:25}],17:[function(n,t){for(var e="assert,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profileEnd,time,timeEnd,trace,warn".split(","),r=e.length,i=function(){},o={};r--;)o[e[r]]=i;t.exports=o},{}],18:[function(n,t){function e(n){return"type: "+n.type+"\r\n"+n.sdp}function r(n,t){var e=this;a.call(this),this.peerconnection=new o.PeerConnection(n,t),this.trace=function(n,t){e.emit("PeerConnectionTrace",{time:new Date,type:n,value:t||""})},this.onicecandidate=null,this.peerconnection.onicecandidate=function(n){e.trace("onicecandidate",JSON.stringify(n.candidate,null," ")),null!==e.onicecandidate&&e.onicecandidate(n)},this.onaddstream=null,this.peerconnection.onaddstream=function(n){e.trace("onaddstream",n.stream.id),null!==e.onaddstream&&e.onaddstream(n)},this.onremovestream=null,this.peerconnection.onremovestream=function(n){e.trace("onremovestream",n.stream.id),null!==e.onremovestream&&e.onremovestream(n)},this.onsignalingstatechange=null,this.peerconnection.onsignalingstatechange=function(n){e.trace("onsignalingstatechange",e.signalingState),null!==e.onsignalingstatechange&&e.onsignalingstatechange(n)},this.oniceconnectionstatechange=null,this.peerconnection.oniceconnectionstatechange=function(n){e.trace("oniceconnectionstatechange",e.iceConnectionState),null!==e.oniceconnectionstatechange&&e.oniceconnectionstatechange(n)},this.onnegotiationneeded=null,this.peerconnection.onnegotiationneeded=function(n){e.trace("onnegotiationneeded"),null!==e.onnegotiationneeded&&e.onnegotiationneeded(n)},e.ondatachannel=null,this.peerconnection.ondatachannel=function(n){e.trace("ondatachannel",n),null!==e.ondatachannel&&e.ondatachannel(n)}}var i=n("util"),o=n("webrtcsupport"),a=n("wildemitter");i.inherits(r,a),void 0!==r.prototype.__defineGetter__&&(r.prototype.__defineGetter__("signalingState",function(){return this.peerconnection.signalingState}),r.prototype.__defineGetter__("iceConnectionState",function(){return this.peerconnection.iceConnectionState}),r.prototype.__defineGetter__("localDescription",function(){return this.peerconnection.localDescription}),r.prototype.__defineGetter__("remoteDescription",function(){return this.peerconnection.remoteDescription})),r.prototype.addStream=function(n){this.trace("addStream",n.id),this.peerconnection.addStream(n)},r.prototype.removeStream=function(n){this.trace("removeStream",n.id),this.peerconnection.removeStream(n)},r.prototype.createDataChannel=function(n,t){return this.trace("createDataChannel",n,t),this.peerconnection.createDataChannel(n,t)},r.prototype.setLocalDescription=function(n,t,r){var i=this;this.trace("setLocalDescription",e(n)),this.peerconnection.setLocalDescription(n,function(){i.trace("setLocalDescriptionOnSuccess"),t()},function(n){i.trace("setLocalDescriptionOnFailure",n),r(n)})},r.prototype.setRemoteDescription=function(n,t,r){var i=this;this.trace("setRemoteDescription",e(n)),this.peerconnection.setRemoteDescription(n,function(){i.trace("setRemoteDescriptionOnSuccess"),t()},function(n){i.trace("setRemoteDescriptionOnFailure",n),r(n)})},r.prototype.close=function(){this.trace("stop"),null!==this.statsinterval&&(window.clearInterval(this.statsinterval),this.statsinterval=null),"closed"!=this.peerconnection.signalingState&&this.peerconnection.close()},r.prototype.createOffer=function(n,t,r){var i=this;this.trace("createOffer",JSON.stringify(r,null," ")),this.peerconnection.createOffer(function(t){i.trace("createOfferOnSuccess",e(t)),n(t)},function(n){i.trace("createOfferOnFailure",n),t(n)},r)},r.prototype.createAnswer=function(n,t,r){var i=this;this.trace("createAnswer",JSON.stringify(r,null," ")),this.peerconnection.createAnswer(function(t){i.trace("createAnswerOnSuccess",e(t)),n(t)},function(n){i.trace("createAnswerOnFailure",n),t(n)},r)},r.prototype.addIceCandidate=function(n){this.trace("addIceCandidate",JSON.stringify(n,null," ")),this.peerconnection.addIceCandidate(n)},r.prototype.getStats=function(n){navigator.mozGetUserMedia||this.peerconnection.getStats(n)},t.exports=r},{util:4,webrtcsupport:25,wildemitter:26}],19:[function(n,t){function e(n,t){var e,r=this;s.call(this),n=n||{},n.iceServers=n.iceServers||[],this.pc=new c(n,t),this.pc.on("*",function(){r.emit.apply(r,arguments)}),this.pc.onremovestream=this.emit.bind(this,"removeStream"),this.pc.onnegotiationneeded=this.emit.bind(this,"negotiationNeeded"),this.pc.oniceconnectionstatechange=this.emit.bind(this,"iceConnectionStateChange"),this.pc.onsignalingstatechange=this.emit.bind(this,"signalingStateChange"),this.pc.onaddstream=this._onAddStream.bind(this),this.pc.onicecandidate=this._onIce.bind(this),this.pc.ondatachannel=this._onDataChannel.bind(this),this.localDescription={contents:[]},this.remoteDescription={contents:[]},this.localStream=null,this.remoteStreams=[],this.config={debug:!1,ice:{},sid:"",isInitiator:!0,sdpSessionID:Date.now(),useJingle:!1};for(e in n)this.config[e]=n[e];this.config.debug&&this.on("*",function(){var t=n.logger||console;t.log("PeerConnection event:",arguments)})}var r=n("underscore"),i=n("util"),o=n("webrtcsupport"),a=n("sdp-jingle-json"),s=n("wildemitter"),c=n("traceablepeerconnection");i.inherits(e,s),e.prototype.__defineGetter__&&(e.prototype.__defineGetter__("signalingState",function(){return this.pc.signalingState}),e.prototype.__defineGetter__("iceConnectionState",function(){return this.pc.iceConnectionState})),e.prototype.addStream=function(n){this.localStream=n,this.pc.addStream(n)},e.prototype.processIce=function(n,t){t=t||function(){};var e=this;if(n.contents){var i=r.pluck(this.remoteDescription.contents,"name"),s=n.contents;s.forEach(function(n){var t=n.transport||{},r=t.candidates||[],s=i.indexOf(n.name),c=n.name;r.forEach(function(n){console.log("addicecandidate");var t=a.toCandidateSDP(n)+"\r\n";e.pc.addIceCandidate(new o.IceCandidate({candidate:t,sdpMLineIndex:s,sdpMid:c}))})})}else e.pc.addIceCandidate(new o.IceCandidate(n.candidate));t()},e.prototype.offer=function(n,t){var e=this,i=2===arguments.length,o=i?n:{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}};t=i?t:n,t=t||function(){},this.pc.createOffer(function(n){e.pc.setLocalDescription(n,function(){var i,o={type:"offer",sdp:n.sdp};e.config.useJingle&&(i=a.toSessionJSON(n.sdp,e.config.isInitiator?"initiator":"responder"),i.sid=e.config.sid,e.localDescription=i,r.each(i.contents,function(n){var t=n.transport||{};t.ufrag&&(e.config.ice[n.name]={ufrag:t.ufrag,pwd:t.pwd})}),o.jingle=i),e.emit("offer",o),t(null,o)},function(n){e.emit("error",n),t(n)})},function(n){e.emit("error",n),t(n)},o)},e.prototype.handleOffer=function(n,t){t=t||function(){};var e=this;n.type="offer",n.jingle&&(n.sdp=a.toSessionSDP(n.jingle,e.config.sdpSessionID)),e.pc.setRemoteDescription(new o.SessionDescription(n),function(){t()},t)},e.prototype.answerAudioOnly=function(n){var t={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!1}};this._answer(t,n)},e.prototype.answerBroadcastOnly=function(n){var t={mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}};this._answer(t,n)},e.prototype.answer=function(n,t){var e=2===arguments.length,r=e?t:n,i=e?n:{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}};this._answer(i,r)},e.prototype.handleAnswer=function(n,t){t=t||function(){};var e=this;n.jingle&&(n.sdp=a.toSessionSDP(n.jingle,e.config.sdpSessionID),e.remoteDescription=n.jingle),e.pc.setRemoteDescription(new o.SessionDescription(n),function(){t(null)},t)},e.prototype.close=function(){this.pc.close(),this.emit("close")},e.prototype._answer=function(n,t){t=t||function(){};var e=this;if(!this.pc.remoteDescription)throw new Error("remoteDescription not set");e.pc.createAnswer(function(n){e.pc.setLocalDescription(n,function(){var r={type:"answer",sdp:n.sdp};if(e.config.useJingle){var i=a.toSessionJSON(n.sdp);i.sid=e.config.sid,e.localDescription=i,r.jingle=i}e.emit("answer",r),t(null,r)},function(n){e.emit("error",n),t(n)})},function(n){e.emit("error",n),t(n)},n)},e.prototype._onIce=function(n){var t=this;if(n.candidate){var e=n.candidate,i={candidate:n.candidate};if(t.config.useJingle){if(!t.config.ice[e.sdpMid]){var o=a.toSessionJSON(t.pc.localDescription.sdp,t.config.isInitiator?"initiator":"responder");r.each(o.contents,function(n){var e=n.transport||{};e.ufrag&&(t.config.ice[n.name]={ufrag:e.ufrag,pwd:e.pwd})})}i.jingle={contents:[{name:e.sdpMid,creator:t.config.isInitiator?"initiator":"responder",transport:{transType:"iceUdp",ufrag:t.config.ice[e.sdpMid].ufrag,pwd:t.config.ice[e.sdpMid].pwd,candidates:[a.toCandidateJSON(e.candidate)]}}]}}this.emit("ice",i)}else this.emit("endOfCandidates")},e.prototype._onDataChannel=function(n){this.emit("addChannel",n.channel)},e.prototype._onAddStream=function(n){this.remoteStreams.push(n.stream),this.emit("addStream",n)},e.prototype.createDataChannel=function(n,t){var e=this.pc.createDataChannel(n,t);return e},t.exports=e},{"sdp-jingle-json":20,traceablepeerconnection:18,underscore:24,util:4,webrtcsupport:25,wildemitter:26}],20:[function(n,t,e){var r=n("./lib/tosdp"),i=n("./lib/tojson");e.toSessionSDP=r.toSessionSDP,e.toMediaSDP=r.toMediaSDP,e.toCandidateSDP=r.toCandidateSDP,e.toSessionJSON=i.toSessionJSON,e.toMediaJSON=i.toMediaJSON,e.toCandidateJSON=i.toCandidateJSON},{"./lib/tojson":22,"./lib/tosdp":23}],21:[function(n,t,e){e.lines=function(n){return n.split("\r\n").filter(function(n){return n.length>0})},e.findLine=function(n,t,e){for(var r=n.length,i=0;i<t.length;i++)if(t[i].substr(0,r)===n)return t[i];if(!e)return!1;for(var o=0;o<e.length;o++)if(e[o].substr(0,r)===n)return e[o];return!1},e.findLines=function(n,t,e){for(var r=[],i=n.length,o=0;o<t.length;o++)t[o].substr(0,i)===n&&r.push(t[o]);if(r.length||!e)return r;for(var a=0;a<e.length;a++)e[a].substr(0,i)===n&&r.push(e[a]);return r},e.mline=function(n){for(var t=n.substr(2).split(" "),e={media:t[0],port:t[1],proto:t[2],formats:[]},r=3;r<t.length;r++)t[r]&&e.formats.push(t[r]);return e},e.rtpmap=function(n){var t=n.substr(9).split(" "),e={id:t.shift()};return t=t[0].split("/"),e.name=t[0],e.clockrate=t[1],e.channels=3==t.length?t[2]:"1",e},e.fmtp=function(n){for(var t,e,r,i=n.substr(n.indexOf(" ")+1).split(";"),o=[],a=0;a<i.length;a++)t=i[a].split("="),e=t[0].trim(),r=t[1],e&&r?o.push({key:e,value:r}):e&&o.push({key:"",value:e});return o},e.crypto=function(n){var t=n.substr(9).split(" "),e={tag:t[0],cipherSuite:t[1],keyParams:t[2],sessionParams:t.slice(3).join(" ")};return e},e.fingerprint=function(n){var t=n.substr(14).split(" ");return{hash:t[0],value:t[1]}},e.extmap=function(n){var t=n.substr(9).split(" "),e={},r=t.shift(),i=r.indexOf("/");return i>=0?(e.id=r.substr(0,i),e.senders=r.substr(i+1)):(e.id=r,e.senders="sendrecv"),e.uri=t.shift()||"",e},e.rtcpfb=function(n){var t=n.substr(10).split(" "),e={};return e.id=t.shift(),e.type=t.shift(),"trr-int"===e.type?e.value=t.shift():e.subtype=t.shift()||"",e.parameters=t,e},e.candidate=function(n){for(var t=n.substring(12).split(" "),e={foundation:t[0],component:t[1],protocol:t[2].toLowerCase(),priority:t[3],ip:t[4],port:t[5],type:t[7],generation:"0"},r=8;r<t.length;r+=2)"raddr"===t[r]?e.relAddr=t[r+1]:"rport"===t[r]?e.relPort=t[r+1]:"generation"===t[r]&&(e.generation=t[r+1]);return e.network="1",e},e.sourceGroups=function(n){for(var t=[],e=0;e<n.length;e++){var r=n[e].substr(13).split(" ");t.push({semantics:r.shift(),sources:r})}return t},e.sources=function(n){for(var t=[],e={},r=0;r<n.length;r++){var i=n[r].substr(7).split(" "),o=i.shift();if(!e[o]){var a={ssrc:o,parameters:[]};t.push(a),e[o]=a}i=i.join(" ").split(":");var s=i.shift(),c=i.join(":")||null;e[o].parameters.push({key:s,value:c})}return t},e.groups=function(n){for(var t,e=[],r=0;r<n.length;r++)t=n[r].substr(8).split(" "),e.push({semantics:t.shift(),contents:t});return e}},{}],22:[function(n,t,e){var r=n("./parsers"),i=Math.random();e._setIdCounter=function(n){i=n},e.toSessionJSON=function(n,t){for(var i=n.split("\r\nm="),o=1;o<i.length;o++)i[o]="m="+i[o],o!==i.length-1&&(i[o]+="\r\n");var a=i.shift()+"\r\n",s=r.lines(a),c={},u=[];i.forEach(function(n){u.push(e.toMediaJSON(n,a,t))}),c.contents=u;var l=r.findLines("a=group:",s);return l.length&&(c.groups=r.groups(l)),c},e.toMediaJSON=function(n,t,i){var o=r.lines(n),a=r.lines(t),s=r.mline(o[0]),c={creator:i,name:s.media,description:{descType:"rtp",media:s.media,payloads:[],encryption:[],feedback:[],headerExtensions:[]},transport:{transType:"iceUdp",candidates:[],fingerprints:[]}},u=c.description,l=c.transport,f=r.findLine("a=ssrc:",o);f&&(u.ssrc=f.substr(7).split(" ")[0]);var p=r.findLine("a=mid:",o);p&&(c.name=p.substr(6)),r.findLine("a=sendrecv",o,a)?c.senders="both":r.findLine("a=sendonly",o,a)?c.senders="initiator":r.findLine("a=recvonly",o,a)?c.senders="responder":r.findLine("a=inactive",o,a)&&(c.senders="none");var d=r.findLines("a=rtpmap:",o);d.forEach(function(n){var t=r.rtpmap(n);t.feedback=[];var e=r.findLines("a=fmtp:"+t.id,o);e.forEach(function(n){t.parameters=r.fmtp(n)});var i=r.findLines("a=rtcp-fb:"+t.id,o);i.forEach(function(n){t.feedback.push(r.rtcpfb(n))}),u.payloads.push(t)});var h=r.findLines("a=crypto:",o,a);h.forEach(function(n){u.encryption.push(r.crypto(n))}),r.findLine("a=rtcp-mux",o)&&(u.mux=!0);var g=r.findLines("a=rtcp-fb:*",o);g.forEach(function(n){u.feedback.push(r.rtcpfb(n))});var m=r.findLines("a=extmap:",o);m.forEach(function(n){var t=r.extmap(n),e={sendonly:"responder",recvonly:"initiator",sendrecv:"both",inactive:"none"};t.senders=e[t.senders],u.headerExtensions.push(t)});var v=r.findLines("a=ssrc-group:",o);u.sourceGroups=r.sourceGroups(v||[]);var y=r.findLines("a=ssrc:",o);u.sources=r.sources(y||[]);var w=r.findLines("a=fingerprint:",o,a);w.forEach(function(n){var t=r.fingerprint(n),e=r.findLine("a=setup:",o,a);e&&(t.setup=e.substr(8)),l.fingerprints.push(t)});var b=r.findLine("a=ice-ufrag:",o,a),S=r.findLine("a=ice-pwd:",o,a);if(b&&S){l.ufrag=b.substr(12),l.pwd=S.substr(10),l.candidates=[];var j=r.findLines("a=candidate:",o,a);j.forEach(function(n){l.candidates.push(e.toCandidateJSON(n))})}return c},e.toCandidateJSON=function(n){var t=r.candidate(n.split("\r\n")[0]);return t.id=(i++).toString(36).substr(0,12),t}},{"./parsers":21}],23:[function(n,t,e){var r={initiator:"sendonly",responder:"recvonly",both:"sendrecv",none:"inactive",sendonly:"initator",recvonly:"responder",sendrecv:"both",inactive:"none"};e.toSessionSDP=function(n,t,r){var i=["v=0","o=- "+(t||n.sid||Date.now())+" "+(r||Date.now())+" IN IP4 0.0.0.0","s=-","t=0 0"],o=n.groups||[];o.forEach(function(n){i.push("a=group:"+n.semantics+" "+n.contents.join(" "))});var a=n.contents||[];return a.forEach(function(n){i.push(e.toMediaSDP(n))}),i.join("\r\n")+"\r\n"},e.toMediaSDP=function(n){var t=[],i=n.description,o=n.transport,a=i.payloads||[],s=o&&o.fingerprints||[],c=[i.media,"1"];c.push(i.encryption&&i.encryption.length>0||s.length>0?"RTP/SAVPF":"RTP/AVPF"),a.forEach(function(n){c.push(n.id)}),t.push("m="+c.join(" ")),t.push("c=IN IP4 0.0.0.0"),t.push("a=rtcp:1 IN IP4 0.0.0.0"),o&&(o.ufrag&&t.push("a=ice-ufrag:"+o.ufrag),o.pwd&&t.push("a=ice-pwd:"+o.pwd),o.setup&&t.push("a=setup:"+o.setup),s.forEach(function(n){t.push("a=fingerprint:"+n.hash+" "+n.value)})),t.push("a="+(r[n.senders]||"sendrecv")),t.push("a=mid:"+n.name),i.mux&&t.push("a=rtcp-mux");var u=i.encryption||[];u.forEach(function(n){t.push("a=crypto:"+n.tag+" "+n.cipherSuite+" "+n.keyParams+(n.sessionParams?" "+n.sessionParams:""))}),a.forEach(function(n){var e="a=rtpmap:"+n.id+" "+n.name+"/"+n.clockrate;if(n.channels&&"1"!=n.channels&&(e+="/"+n.channels),t.push(e),n.parameters&&n.parameters.length){var r=["a=fmtp:"+n.id];n.parameters.forEach(function(n){r.push((n.key?n.key+"=":"")+n.value)}),t.push(r.join(" "))}n.feedback&&n.feedback.forEach(function(e){t.push("trr-int"===e.type?"a=rtcp-fb:"+n.id+" trr-int "+e.value?e.value:"0":"a=rtcp-fb:"+n.id+" "+e.type+(e.subtype?" "+e.subtype:""))})}),i.feedback&&i.feedback.forEach(function(n){t.push("trr-int"===n.type?n.value:"a=rtcp-fb:* "+n.type+(n.subtype?" "+n.subtype:""))});var l=i.headerExtensions||[];l.forEach(function(n){t.push("a=extmap:"+n.id+(n.senders?"/"+r[n.senders]:"")+" "+n.uri)});var f=i.sourceGroups||[];f.forEach(function(n){t.push("a=ssrc-group:"+n.semantics+" "+n.sources.join(" "))});var p=i.sources||[];p.forEach(function(n){for(var e=0;e<n.parameters.length;e++){var r=n.parameters[e];t.push("a=ssrc:"+(n.ssrc||i.ssrc)+" "+r.key+(r.value?":"+r.value:""))}});var d=o.candidates||[];return d.forEach(function(n){t.push(e.toCandidateSDP(n))}),t.join("\r\n")},e.toCandidateSDP=function(n){var t=[];t.push(n.foundation),t.push(n.component),t.push(n.protocol),t.push(n.priority),t.push(n.ip),t.push(n.port);var e=n.type;return t.push("typ"),t.push(e),("srflx"===e||"prflx"===e||"relay"===e)&&n.relAddr&&n.relPort&&(t.push("raddr"),t.push(n.relAddr),t.push("rport"),t.push(n.relPort)),t.push("generation"),t.push(n.generation||"0"),"a=candidate:"+t.join(" ")}},{}],24:[function(n,t,e){(function(){var n=this,r=n._,i={},o=Array.prototype,a=Object.prototype,s=Function.prototype,c=o.push,u=o.slice,l=o.concat,f=a.toString,p=a.hasOwnProperty,d=o.forEach,h=o.map,g=o.reduce,m=o.reduceRight,v=o.filter,y=o.every,w=o.some,b=o.indexOf,S=o.lastIndexOf,j=Array.isArray,x=Object.keys,O=s.bind,k=function(n){return n instanceof k?n:this instanceof k?void(this._wrapped=n):new k(n)};"undefined"!=typeof e?("undefined"!=typeof t&&t.exports&&(e=t.exports=k),e._=k):n._=k,k.VERSION="1.6.0";var E=k.each=k.forEach=function(n,t,e){if(null==n)return n;if(d&&n.forEach===d)n.forEach(t,e);else if(n.length===+n.length){for(var r=0,o=n.length;o>r;r++)if(t.call(e,n[r],r,n)===i)return}else for(var a=k.keys(n),r=0,o=a.length;o>r;r++)if(t.call(e,n[a[r]],a[r],n)===i)return;return n};k.map=k.collect=function(n,t,e){var r=[];return null==n?r:h&&n.map===h?n.map(t,e):(E(n,function(n,i,o){r.push(t.call(e,n,i,o))}),r)};var A="Reduce of empty array with no initial value";k.reduce=k.foldl=k.inject=function(n,t,e,r){var i=arguments.length>2;if(null==n&&(n=[]),g&&n.reduce===g)return r&&(t=k.bind(t,r)),i?n.reduce(t,e):n.reduce(t);if(E(n,function(n,o,a){i?e=t.call(r,e,n,o,a):(e=n,i=!0)}),!i)throw new TypeError(A);return e},k.reduceRight=k.foldr=function(n,t,e,r){var i=arguments.length>2;if(null==n&&(n=[]),m&&n.reduceRight===m)return r&&(t=k.bind(t,r)),i?n.reduceRight(t,e):n.reduceRight(t);var o=n.length;if(o!==+o){var a=k.keys(n);o=a.length}if(E(n,function(s,c,u){c=a?a[--o]:--o,i?e=t.call(r,e,n[c],c,u):(e=n[c],i=!0)}),!i)throw new TypeError(A);return e},k.find=k.detect=function(n,t,e){var r;return C(n,function(n,i,o){return t.call(e,n,i,o)?(r=n,!0):void 0}),r},k.filter=k.select=function(n,t,e){var r=[];return null==n?r:v&&n.filter===v?n.filter(t,e):(E(n,function(n,i,o){t.call(e,n,i,o)&&r.push(n)}),r)},k.reject=function(n,t,e){return k.filter(n,function(n,r,i){return!t.call(e,n,r,i)},e)},k.every=k.all=function(n,t,e){t||(t=k.identity);var r=!0;return null==n?r:y&&n.every===y?n.every(t,e):(E(n,function(n,o,a){return(r=r&&t.call(e,n,o,a))?void 0:i}),!!r)};var C=k.some=k.any=function(n,t,e){t||(t=k.identity);var r=!1;return null==n?r:w&&n.some===w?n.some(t,e):(E(n,function(n,o,a){return r||(r=t.call(e,n,o,a))?i:void 0}),!!r)};k.contains=k.include=function(n,t){return null==n?!1:b&&n.indexOf===b?-1!=n.indexOf(t):C(n,function(n){return n===t})},k.invoke=function(n,t){var e=u.call(arguments,2),r=k.isFunction(t);return k.map(n,function(n){return(r?t:n[t]).apply(n,e)})},k.pluck=function(n,t){return k.map(n,k.property(t))},k.where=function(n,t){return k.filter(n,k.matches(t))},k.findWhere=function(n,t){return k.find(n,k.matches(t))},k.max=function(n,t,e){if(!t&&k.isArray(n)&&n[0]===+n[0]&&n.length<65535)return Math.max.apply(Math,n);var r=-1/0,i=-1/0;return E(n,function(n,o,a){var s=t?t.call(e,n,o,a):n;s>i&&(r=n,i=s)}),r},k.min=function(n,t,e){if(!t&&k.isArray(n)&&n[0]===+n[0]&&n.length<65535)return Math.min.apply(Math,n);var r=1/0,i=1/0;return E(n,function(n,o,a){var s=t?t.call(e,n,o,a):n;i>s&&(r=n,i=s)}),r},k.shuffle=function(n){var t,e=0,r=[];return E(n,function(n){t=k.random(e++),r[e-1]=r[t],r[t]=n}),r},k.sample=function(n,t,e){return null==t||e?(n.length!==+n.length&&(n=k.values(n)),n[k.random(n.length-1)]):k.shuffle(n).slice(0,Math.max(0,t))};var _=function(n){return null==n?k.identity:k.isFunction(n)?n:k.property(n)};k.sortBy=function(n,t,e){return t=_(t),k.pluck(k.map(n,function(n,r,i){return{value:n,index:r,criteria:t.call(e,n,r,i)}}).sort(function(n,t){var e=n.criteria,r=t.criteria;if(e!==r){if(e>r||void 0===e)return 1;if(r>e||void 0===r)return-1}return n.index-t.index}),"value")};var I=function(n){return function(t,e,r){var i={};return e=_(e),E(t,function(o,a){var s=e.call(r,o,a,t);n(i,s,o)}),i}};k.groupBy=I(function(n,t,e){k.has(n,t)?n[t].push(e):n[t]=[e]}),k.indexBy=I(function(n,t,e){n[t]=e}),k.countBy=I(function(n,t){k.has(n,t)?n[t]++:n[t]=1}),k.sortedIndex=function(n,t,e,r){e=_(e);for(var i=e.call(r,t),o=0,a=n.length;a>o;){var s=o+a>>>1;e.call(r,n[s])<i?o=s+1:a=s}return o},k.toArray=function(n){return n?k.isArray(n)?u.call(n):n.length===+n.length?k.map(n,k.identity):k.values(n):[]},k.size=function(n){return null==n?0:n.length===+n.length?n.length:k.keys(n).length},k.first=k.head=k.take=function(n,t,e){return null==n?void 0:null==t||e?n[0]:0>t?[]:u.call(n,0,t)},k.initial=function(n,t,e){return u.call(n,0,n.length-(null==t||e?1:t))},k.last=function(n,t,e){return null==n?void 0:null==t||e?n[n.length-1]:u.call(n,Math.max(n.length-t,0))},k.rest=k.tail=k.drop=function(n,t,e){return u.call(n,null==t||e?1:t)},k.compact=function(n){return k.filter(n,k.identity)};var D=function(n,t,e){return t&&k.every(n,k.isArray)?l.apply(e,n):(E(n,function(n){k.isArray(n)||k.isArguments(n)?t?c.apply(e,n):D(n,t,e):e.push(n)}),e)};k.flatten=function(n,t){return D(n,t,[])},k.without=function(n){return k.difference(n,u.call(arguments,1))},k.partition=function(n,t){var e=[],r=[];return E(n,function(n){(t(n)?e:r).push(n)}),[e,r]},k.uniq=k.unique=function(n,t,e,r){k.isFunction(t)&&(r=e,e=t,t=!1);var i=e?k.map(n,e,r):n,o=[],a=[];return E(i,function(e,r){(t?r&&a[a.length-1]===e:k.contains(a,e))||(a.push(e),o.push(n[r]))}),o},k.union=function(){return k.uniq(k.flatten(arguments,!0))},k.intersection=function(n){var t=u.call(arguments,1);return k.filter(k.uniq(n),function(n){return k.every(t,function(t){return k.contains(t,n)})})},k.difference=function(n){var t=l.apply(o,u.call(arguments,1));return k.filter(n,function(n){return!k.contains(t,n)})},k.zip=function(){for(var n=k.max(k.pluck(arguments,"length").concat(0)),t=new Array(n),e=0;n>e;e++)t[e]=k.pluck(arguments,""+e);return t},k.object=function(n,t){if(null==n)return{};for(var e={},r=0,i=n.length;i>r;r++)t?e[n[r]]=t[r]:e[n[r][0]]=n[r][1];return e},k.indexOf=function(n,t,e){if(null==n)return-1;var r=0,i=n.length;if(e){if("number"!=typeof e)return r=k.sortedIndex(n,t),n[r]===t?r:-1;r=0>e?Math.max(0,i+e):e}if(b&&n.indexOf===b)return n.indexOf(t,e);for(;i>r;r++)if(n[r]===t)return r;return-1},k.lastIndexOf=function(n,t,e){if(null==n)return-1;var r=null!=e;if(S&&n.lastIndexOf===S)return r?n.lastIndexOf(t,e):n.lastIndexOf(t);for(var i=r?e:n.length;i--;)if(n[i]===t)return i;return-1},k.range=function(n,t,e){arguments.length<=1&&(t=n||0,n=0),e=arguments[2]||1;for(var r=Math.max(Math.ceil((t-n)/e),0),i=0,o=new Array(r);r>i;)o[i++]=n,n+=e;return o};var T=function(){};k.bind=function(n,t){var e,r;if(O&&n.bind===O)return O.apply(n,u.call(arguments,1));if(!k.isFunction(n))throw new TypeError;return e=u.call(arguments,2),r=function(){if(!(this instanceof r))return n.apply(t,e.concat(u.call(arguments)));T.prototype=n.prototype;var i=new T;T.prototype=null;var o=n.apply(i,e.concat(u.call(arguments)));return Object(o)===o?o:i}},k.partial=function(n){var t=u.call(arguments,1);return function(){for(var e=0,r=t.slice(),i=0,o=r.length;o>i;i++)r[i]===k&&(r[i]=arguments[e++]);for(;e<arguments.length;)r.push(arguments[e++]);return n.apply(this,r)}},k.bindAll=function(n){var t=u.call(arguments,1);if(0===t.length)throw new Error("bindAll must be passed function names");return E(t,function(t){n[t]=k.bind(n[t],n)}),n},k.memoize=function(n,t){var e={};return t||(t=k.identity),function(){var r=t.apply(this,arguments);return k.has(e,r)?e[r]:e[r]=n.apply(this,arguments)}},k.delay=function(n,t){var e=u.call(arguments,2);return setTimeout(function(){return n.apply(null,e)},t)},k.defer=function(n){return k.delay.apply(k,[n,1].concat(u.call(arguments,1)))},k.throttle=function(n,t,e){var r,i,o,a=null,s=0;e||(e={});var c=function(){s=e.leading===!1?0:k.now(),a=null,o=n.apply(r,i),r=i=null};return function(){var u=k.now();s||e.leading!==!1||(s=u);var l=t-(u-s);return r=this,i=arguments,0>=l?(clearTimeout(a),a=null,s=u,o=n.apply(r,i),r=i=null):a||e.trailing===!1||(a=setTimeout(c,l)),o}},k.debounce=function(n,t,e){var r,i,o,a,s,c=function(){var u=k.now()-a;t>u?r=setTimeout(c,t-u):(r=null,e||(s=n.apply(o,i),o=i=null))};return function(){o=this,i=arguments,a=k.now();var u=e&&!r;return r||(r=setTimeout(c,t)),u&&(s=n.apply(o,i),o=i=null),s}},k.once=function(n){var t,e=!1;return function(){return e?t:(e=!0,t=n.apply(this,arguments),n=null,t)}},k.wrap=function(n,t){return k.partial(t,n)},k.compose=function(){var n=arguments;return function(){for(var t=arguments,e=n.length-1;e>=0;e--)t=[n[e].apply(this,t)];return t[0]}},k.after=function(n,t){return function(){return--n<1?t.apply(this,arguments):void 0}},k.keys=function(n){if(!k.isObject(n))return[];if(x)return x(n);var t=[];for(var e in n)k.has(n,e)&&t.push(e);return t},k.values=function(n){for(var t=k.keys(n),e=t.length,r=new Array(e),i=0;e>i;i++)r[i]=n[t[i]];return r},k.pairs=function(n){for(var t=k.keys(n),e=t.length,r=new Array(e),i=0;e>i;i++)r[i]=[t[i],n[t[i]]];return r},k.invert=function(n){for(var t={},e=k.keys(n),r=0,i=e.length;i>r;r++)t[n[e[r]]]=e[r];return t},k.functions=k.methods=function(n){var t=[];for(var e in n)k.isFunction(n[e])&&t.push(e);return t.sort()},k.extend=function(n){return E(u.call(arguments,1),function(t){if(t)for(var e in t)n[e]=t[e]}),n},k.pick=function(n){var t={},e=l.apply(o,u.call(arguments,1));return E(e,function(e){e in n&&(t[e]=n[e])}),t},k.omit=function(n){var t={},e=l.apply(o,u.call(arguments,1));for(var r in n)k.contains(e,r)||(t[r]=n[r]);return t},k.defaults=function(n){return E(u.call(arguments,1),function(t){if(t)for(var e in t)void 0===n[e]&&(n[e]=t[e])}),n},k.clone=function(n){return k.isObject(n)?k.isArray(n)?n.slice():k.extend({},n):n},k.tap=function(n,t){return t(n),n
};var M=function(n,t,e,r){if(n===t)return 0!==n||1/n==1/t;if(null==n||null==t)return n===t;n instanceof k&&(n=n._wrapped),t instanceof k&&(t=t._wrapped);var i=f.call(n);if(i!=f.call(t))return!1;switch(i){case"[object String]":return n==String(t);case"[object Number]":return n!=+n?t!=+t:0==n?1/n==1/t:n==+t;case"[object Date]":case"[object Boolean]":return+n==+t;case"[object RegExp]":return n.source==t.source&&n.global==t.global&&n.multiline==t.multiline&&n.ignoreCase==t.ignoreCase}if("object"!=typeof n||"object"!=typeof t)return!1;for(var o=e.length;o--;)if(e[o]==n)return r[o]==t;var a=n.constructor,s=t.constructor;if(a!==s&&!(k.isFunction(a)&&a instanceof a&&k.isFunction(s)&&s instanceof s)&&"constructor"in n&&"constructor"in t)return!1;e.push(n),r.push(t);var c=0,u=!0;if("[object Array]"==i){if(c=n.length,u=c==t.length)for(;c--&&(u=M(n[c],t[c],e,r)););}else{for(var l in n)if(k.has(n,l)&&(c++,!(u=k.has(t,l)&&M(n[l],t[l],e,r))))break;if(u){for(l in t)if(k.has(t,l)&&!c--)break;u=!c}}return e.pop(),r.pop(),u};k.isEqual=function(n,t){return M(n,t,[],[])},k.isEmpty=function(n){if(null==n)return!0;if(k.isArray(n)||k.isString(n))return 0===n.length;for(var t in n)if(k.has(n,t))return!1;return!0},k.isElement=function(n){return!(!n||1!==n.nodeType)},k.isArray=j||function(n){return"[object Array]"==f.call(n)},k.isObject=function(n){return n===Object(n)},E(["Arguments","Function","String","Number","Date","RegExp"],function(n){k["is"+n]=function(t){return f.call(t)=="[object "+n+"]"}}),k.isArguments(arguments)||(k.isArguments=function(n){return!(!n||!k.has(n,"callee"))}),"function"!=typeof/./&&(k.isFunction=function(n){return"function"==typeof n}),k.isFinite=function(n){return isFinite(n)&&!isNaN(parseFloat(n))},k.isNaN=function(n){return k.isNumber(n)&&n!=+n},k.isBoolean=function(n){return n===!0||n===!1||"[object Boolean]"==f.call(n)},k.isNull=function(n){return null===n},k.isUndefined=function(n){return void 0===n},k.has=function(n,t){return p.call(n,t)},k.noConflict=function(){return n._=r,this},k.identity=function(n){return n},k.constant=function(n){return function(){return n}},k.property=function(n){return function(t){return t[n]}},k.matches=function(n){return function(t){if(t===n)return!0;for(var e in n)if(n[e]!==t[e])return!1;return!0}},k.times=function(n,t,e){for(var r=Array(Math.max(0,n)),i=0;n>i;i++)r[i]=t.call(e,i);return r},k.random=function(n,t){return null==t&&(t=n,n=0),n+Math.floor(Math.random()*(t-n+1))},k.now=Date.now||function(){return(new Date).getTime()};var P={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};P.unescape=k.invert(P.escape);var R={escape:new RegExp("["+k.keys(P.escape).join("")+"]","g"),unescape:new RegExp("("+k.keys(P.unescape).join("|")+")","g")};k.each(["escape","unescape"],function(n){k[n]=function(t){return null==t?"":(""+t).replace(R[n],function(t){return P[n][t]})}}),k.result=function(n,t){if(null==n)return void 0;var e=n[t];return k.isFunction(e)?e.call(n):e},k.mixin=function(n){E(k.functions(n),function(t){var e=k[t]=n[t];k.prototype[t]=function(){var n=[this._wrapped];return c.apply(n,arguments),J.call(this,e.apply(k,n))}})};var N=0;k.uniqueId=function(n){var t=++N+"";return n?n+t:t},k.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var L=/(.)^/,z={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},F=/\\|'|\r|\n|\t|\u2028|\u2029/g;k.template=function(n,t,e){var r;e=k.defaults({},e,k.templateSettings);var i=new RegExp([(e.escape||L).source,(e.interpolate||L).source,(e.evaluate||L).source].join("|")+"|$","g"),o=0,a="__p+='";n.replace(i,function(t,e,r,i,s){return a+=n.slice(o,s).replace(F,function(n){return"\\"+z[n]}),e&&(a+="'+\n((__t=("+e+"))==null?'':_.escape(__t))+\n'"),r&&(a+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(a+="';\n"+i+"\n__p+='"),o=s+t.length,t}),a+="';\n",e.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{r=new Function(e.variable||"obj","_",a)}catch(s){throw s.source=a,s}if(t)return r(t,k);var c=function(n){return r.call(this,n,k)};return c.source="function("+(e.variable||"obj")+"){\n"+a+"}",c},k.chain=function(n){return k(n).chain()};var J=function(n){return this._chain?k(n).chain():n};k.mixin(k),E(["pop","push","reverse","shift","sort","splice","unshift"],function(n){var t=o[n];k.prototype[n]=function(){var e=this._wrapped;return t.apply(e,arguments),"shift"!=n&&"splice"!=n||0!==e.length||delete e[0],J.call(this,e)}}),E(["concat","join","slice"],function(n){var t=o[n];k.prototype[n]=function(){return J.call(this,t.apply(this._wrapped,arguments))}}),k.extend(k.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return k})}).call(this)},{}],25:[function(n,t){var e,r=!1,i=!1,o=window.navigator.userAgent.toLowerCase();-1!==o.indexOf("firefox")?(e="moz",i=!0):-1!==o.indexOf("chrome")&&(e="webkit",r=!0);var a=window.mozRTCPeerConnection||window.webkitRTCPeerConnection,s=window.mozRTCIceCandidate||window.RTCIceCandidate,c=window.mozRTCSessionDescription||window.RTCSessionDescription,u=window.webkitMediaStream||window.MediaStream,l="https:"===window.location.protocol&&window.navigator.userAgent.match("Chrome")&&parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10)>=26,f=window.webkitAudioContext||window.AudioContext;t.exports={support:!!a,dataChannel:r||i||a&&a.prototype&&a.prototype.createDataChannel,prefix:e,webAudio:!(!f||!f.prototype.createMediaStreamSource),mediaStream:!(!u||!u.prototype.removeTrack),screenSharing:!!l,AudioContext:f,PeerConnection:a,SessionDescription:c,IceCandidate:s}},{}],26:[function(n,t){function e(){this.callbacks={}}t.exports=e,e.prototype.on=function(n){var t=3===arguments.length,e=t?arguments[1]:void 0,r=t?arguments[2]:arguments[1];return r._groupName=e,(this.callbacks[n]=this.callbacks[n]||[]).push(r),this},e.prototype.once=function(n){function t(){e.off(n,t),o.apply(this,arguments)}var e=this,r=3===arguments.length,i=r?arguments[1]:void 0,o=r?arguments[2]:arguments[1];return this.on(n,i,t),this},e.prototype.releaseGroup=function(n){var t,e,r,i;for(t in this.callbacks)for(i=this.callbacks[t],e=0,r=i.length;r>e;e++)i[e]._groupName===n&&(i.splice(e,1),e--,r--);return this},e.prototype.off=function(n,t){var e,r=this.callbacks[n];return r?1===arguments.length?(delete this.callbacks[n],this):(e=r.indexOf(t),r.splice(e,1),this):this},e.prototype.emit=function(n){var t,e,r,i=[].slice.call(arguments,1),o=this.callbacks[n],a=this.getWildcardCallbacks(n);if(o)for(r=o.slice(),t=0,e=r.length;e>t&&r[t];++t)r[t].apply(this,i);if(a)for(e=a.length,r=a.slice(),t=0,e=r.length;e>t&&r[t];++t)r[t].apply(this,[n].concat(i));return this},e.prototype.getWildcardCallbacks=function(n){var t,e,r=[];for(t in this.callbacks)e=t.split("*"),("*"===t||2===e.length&&n.slice(0,e[0].length)===e[0])&&(r=r.concat(this.callbacks[t]));return r}},{}]},{},[1]);